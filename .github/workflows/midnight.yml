name: WebKey Automated Snapshot

on:
  schedule:
    # í•œêµ­ ì‹œê°„(KST) ë§¤ì¼ 00:05ë¶„ì— ì‹¤í–‰ (UTC 15:05)
    - cron: '5 15 * * *'
  workflow_dispatch: # ì–¸ì œë“  ë²„íŠ¼ ëˆŒëŸ¬ì„œ ì¦‰ì‹œ ê¸°ì¤€ì  ê°±ì‹  ê°€ëŠ¥

jobs:
  update-snapshot:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install web3 requests

      - name: Run Snapshot & Update JSON
        env:
          # í•„ìš”í•œ ê²½ìš° ì‹œí¬ë¦¿ ì„¤ì • (ê¸°ë³¸ì€ ê³µê°œ RPC ì‚¬ìš© ê°€ëŠ¥)
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          # íŒŒì´ì¬ ì‹¤í–‰ ì‹œ 'snapshot' ì¸ìë¥¼ ì£¼ì–´ ê¸°ë¡ ëª¨ë“œë¡œ ë™ì‘í•˜ê²Œ í•¨
          python main.py --snapshot 

      - name: Commit and Push Changes
        run: |
          git config --global user.name 'WebKey-Bot'
          git config --global user.email 'bot@webkeydao.com'
          git add webkey_daily_data.json webkey_weekly_data.json webkey_monthly_data.json
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹ (ìˆ˜ë™ ë°ì´í„°ê°€ ìµœì‹ ìœ¼ë¡œ ê°±ì‹ ë¨)
          git commit -m "ğŸš€ [Auto] ê¸°ì¤€ì  ë°ì´í„° ìë™ ê°±ì‹  (${{ github.event_name }})" || echo "No changes to commit"
          git push
